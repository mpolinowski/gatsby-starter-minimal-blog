---
date: "2019-06-15"
title: "Installing Discourse on Centos 8"
categories:
  - Linux
  - Docker
---

![Mongkok, Hongkong](./photo-456t66d_64567fh6dgjkhg4_d.jpg)


## Download Discourse from Github

Create a `/opt/discourse` folder, where all the Discourse-related files will reside:


```bash
sudo mkdir /opt/discourse
```


Clone the [official Discourse Docker Image](https://github.com/discourse/discourse_docker) into this /var/discourse folder:


```bash
sudo git clone https://github.com/discourse/discourse_docker.git /opt/discourse
```


## Configure Discourse

In this section we will configure your initial Discourse settings.

Switch to the `/opt/discourse` directory:

cd /var/discourse
Copy the samples/standalone.yml file into the containers folder as app.yml:

sudo cp samples/standalone.yml containers/app.yml
Edit the Discourse configuration in the app.yml file:

sudo nano containers/app.yml
The configuration file will open in the nano text editor.

Locate the env section and update it with your custom email, domain, and SMTP server information, as shown below. The individual lines are explained after the example block:

app.yml
```yaml
env:
  LANG: en_US.UTF-8
  ## TODO: How many concurrent web requests are supported?
  ## With 2GB we recommend 3-4 workers, with 1GB only 2
  #UNICORN_WORKERS: 3
  ##
  ## TODO: List of comma delimited emails that will be made admin and developer
  ## on initial signup example 'user1@example.com,user2@example.com'
  DISCOURSE_DEVELOPER_EMAILS: 'me@example.com'
  ##
  ## TODO: The domain name this Discourse instance will respond to
  DISCOURSE_HOSTNAME: 'discourse.example.com'
  ##
  ## TODO: The mailserver this Discourse instance will use
  DISCOURSE_SMTP_ADDRESS: smtp.mandrillapp.com         # (mandatory)
  DISCOURSE_SMTP_PORT: 587                        # (optional)
  DISCOURSE_SMTP_USER_NAME: login@example.com      # (optional)
  DISCOURSE_SMTP_PASSWORD: 9gM5oAw5pBB50KvjcwAmpQ               # (optional)
  ##
  ## The CDN address for this Discourse instance (configured to pull)
  #DISCOURSE_CDN_URL: //discourse-cdn.example.com
```


Here are the individual lines that need to be changed:

### Set Admin Email

Choose the email address that you want to use for the Discourse admin account. It can be totally unrelated to your Discourse domain and can be any email address you find convenient. Set this email address in the DISCOURSE_DEVELOPER_EMAILS line. This email address will be made the Discourse admin by default, once a user registers with that email. You’ll need this email address later when you set up Discourse from its web control panel.


```yaml
DISCOURSE_DEVELOPER_EMAILS: 'me@example.com'
```

Replace me@example.com with your email.

Developer Email setup is required for creating and activating your initial administrator account.

### Set Domain

Set DISCOURSE_HOSTNAME to discourse.example.com. This means you want your Discourse forum to be available at http://discourse.example.com/. You can use an IP address here instead if you don’t have a domain pointing to your server yet. Only one domain (or IP) can be listed here.

DISCOURSE_HOSTNAME: 'discourse.example.com'
Replace discourse.example.com with your domain. A hostname is required to access your Discourse instance from the web.

### Set Mail Credentials

We recommend Mandrill for your SMTP mail server. Get your SMTP credentials from Mandrill.

Enter your SMTP credentials in the lines for `DISCOURSE_SMTP_ADDRESS`, `DISCOURSE_SMTP_PORT`, `DISCOURSE_SMTP_USER_NAME`, and `DISCOURSE_SMTP_PASSWORD`. (Be sure you remove the comment # character from the beginnings of these lines as necessary.)


```yaml
DISCOURSE_SMTP_ADDRESS: smtp.mandrillapp.com    # (mandatory)
DISCOURSE_SMTP_PORT: 587                        # (optional)
DISCOURSE_SMTP_USER_NAME: login@example.com     # (optional)
DISCOURSE_SMTP_PASSWORD: 9gM5oAw5pBB50KvjcwAmpQ # (optional)
```


The SMTP settings are required to send mail from your Discourse instance; for example, to send registration emails, password reset emails, reply notifications, etc.

Having trouble setting up mail credentials? See the Discourse Email Troubleshooting guide.

Setting up mail credentials is required, or else you will not be able to bootstrap your Discourse instance. The credentials must be correct, or else you will not be able to register users (including the admin user) for the forum.


### Optional: Tune Memory Settings (preferred for 1 GB Droplet)

Also in the env section of the configuration file, set db_shared_buffers to 128MB and UNICORN_WORKERS to 2 so you have more memory room.


```yaml
db_shared_buffers: "128MB"
```


and


```yaml
UNICORN_WORKERS: 2
```


Tuning these memory settings will optimize Discourse performance on a 1 GB Droplet.

__NOTE__: The above changes are mandatory and should not be skipped, or else you will have a broken Discourse forum.

Save the app.yml file, and exit the text editor.



## Bootstrap Discourse


In this section we will bootstrap Discourse.

First, we need to make sure that Docker can access all of the outside resources it needs. Open the Docker settings file `/etc/default/docker`:


```bash
sudo nano /etc/default/docker
```


Uncomment the `DOCKER_OPTS` line so Docker uses Google’s DNS:


/etc/default/docker
```
# Use DOCKER_OPTS to modify the daemon startup options.
DOCKER_OPTS="--dns 8.8.8.8 --dns 8.8.4.4"
```


Restart Docker to apply the new settings:


```bash
sudo service docker restart
```


__Note__: If you don’t change Docker’s DNS settings before running the bootstrap command, you may get an error like _fatal: unable to access ’https://github.com/SamSaffron/pups.git/’: Could not resolve host: github.com_.


Now use the bootstrap process to build Discourse and initialize it with all the settings you configured in the previous section. This also starts the Docker container. You must be in the `/opt/discourse` directory:


```bash
cd /opt/discourse
```


Bootstrap Discourse:


```bash
sudo ./launcher bootstrap app
```


This command will take about 8 minutes to run while it configures your Discourse environment. (Early in this process you will be asked to generate a SSH key; press Y to accept.)

After the bootstrap process completes, start Discourse:


```bash
sudo ./launcher start app
```


Congratulations! You now have your very own Discourse instance!



## Access Discourse

Visit the domain or IP address (that you set for the Discourse hostname previously) in your web browser to view the default Discourse web page.


![Discourse on CentOS 8](./Discourse_01.png)


If you receive a 502 Bad Gateway error, try waiting a minute or two and then refreshing so Discourse can finish starting.



## Sign Up and Create Admin Account

Use the Sign Up button at the top right of the page to register a new Discourse account. You should use the email address you provided in the `DISCOURSE_DEVELOPER_EMAILS` setting previously. Once you confirm your account, that account will automatically be granted admin privileges.


Once you sign up and log in, you should see the Staff topics and the [Admin Quick Start Guide](https://github.com/discourse/discourse/blob/master/docs/ADMIN-QUICK-START-GUIDE.md). It contains the next steps for further configuring and customizing your Discourse installation.

You can access the admin dashboard by visting `/admin`.


If you don’t get any email from signing up, and are unable to register a new admin account, please see the [Discourse email troubleshooting checklist](https://meta.discourse.org/t/troubleshooting-email-on-a-new-discourse-install/16326).

If you are still unable to register a new admin account via email, see the [Create Admin Account from Console](https://meta.discourse.org/t/create-admin-account-from-console/17274) walkthrough, but please note that you will have a broken site until you get normal SMTP email working.



## Upgrade

To upgrade Discourse to the latest version, visit `/admin/upgrade` and follow the instructions.



<!-- https://www.digitalocean.com/community/tutorials/how-to-install-discourse-on-ubuntu-14-04 -->